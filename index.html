<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RNA Link Encoder/Decoder</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for textareas */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-lg">
        
        <!-- Header Section (Logo + Title + Credits) -->
        <div class="flex flex-col items-center text-center mb-6">
            <div class="h-16 w-16 rounded-2xl overflow-hidden shadow-lg border border-gray-100 bg-white mb-4">
                 <img 
                    src="logo.jpg" 
                    alt="Logo" 
                    class="h-full w-full object-cover"
                    onerror="this.src='https://ui-avatars.com/api/?name=RNA+Link&background=4f46e5&color=fff&size=128'"
                 />
            </div>
            
            <h1 class="text-3xl font-bold text-center text-indigo-600">
                RNA Link Cipher
            </h1>

            <p class="text-xs text-gray-400 mt-3 font-mono border-t border-gray-100 pt-3 w-full max-w-xs mx-auto">
                Created by Carlos David <a href="https://cdcruzher.com" target="_blank" rel="noopener noreferrer" class="text-indigo-500 hover:text-indigo-600 font-semibold transition-colors">@cdcruzher</a>
            </p>
        </div>

        <!-- Message Area -->
        <div id="messageArea" class="text-center mb-4 min-h-[1.5em]"></div>

        <!-- Encoder Section -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-3 text-gray-800">1. Encode Link to RNA</h2>
            <label for="urlInput" class="block text-sm font-medium text-gray-700 mb-1">Enter Web Link (URL)</label>
            <input type="text" id="urlInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="https://www.example.com">
            <button id="encodeButton" class="w-full bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors mt-3">
                Encode
            </button>
            
            <label for="rnaOutput" class="block text-sm font-medium text-gray-700 mt-4 mb-1">Generated RNA Sequence</label>
            <textarea id="rnaOutput" rows="4" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none" readonly placeholder="RNA sequence will appear here..."></textarea>
            <button id="copyButton" class="w-full bg-gray-500 text-white p-2 rounded-lg font-semibold hover:bg-gray-600 transition-colors mt-2 text-sm">
                Copy Sequence
            </button>
        </div>

        <!-- Divider -->
        <hr class="border-gray-300 my-8">

        <!-- Decoder Section -->
        <div class="mb-2">
            <h2 class="text-xl font-semibold mb-3 text-gray-800">2. Decode RNA to Link</h2>
            <label for="rnaInput" class="block text-sm font-medium text-gray-700 mb-1">Paste RNA Sequence</label>
            <textarea id="rnaInput" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="AUGCGUAC..."></textarea>
            <button id="decodeButton" class="w-full bg-green-600 text-white p-3 rounded-lg font-semibold hover:bg-green-700 transition-colors mt-3">
                Decode
            </button>

            <label class="block text-sm font-medium text-gray-700 mt-4 mb-1">Unveiled Link</label>
            <div id="decodedLinkOutput" class="w-full p-3 border border-gray-200 rounded-lg bg-gray-50 min-h-[5em]">
                <span class="text-gray-400">Link will appear here...</span>
            </div>
        </div>

        <!-- Donation Section (New Logic) -->
        <div class="mt-8 pt-6 border-t border-gray-200 flex flex-col items-center">
            <p class="text-xs text-gray-400 mb-2 uppercase tracking-wider font-semibold">Support the Project</p>
            <a href="https://www.paypal.com/donate/?business=6EN68NHUTM2KQ&no_recurring=0&item_name=Thanks+for+your+support+Amigo%21&currency_code=USD" target="_blank" rel="noopener noreferrer" class="block w-32 h-32 bg-white p-2 rounded-xl border border-gray-200 hover:shadow-md hover:scale-105 transition-all cursor-pointer" title="Scan or Click to Donate">
                <img 
                    src="qrcode.jpg" 
                    alt="Donate QR Code" 
                    class="w-full h-full object-contain"
                    onerror="this.src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https%3A%2F%2Fwww.paypal.com%2Fdonate%2F%3Fbusiness%3D6EN68NHUTM2KQ%26no_recurring%3D0%26item_name%3DThanks%2Bfor%2Byour%2Bsupport%2BAmigo%21%26currency_code%3DUSD'"
                />
            </a>
            <p class="text-[10px] text-gray-400 mt-2 text-center">Scan or click the QR code to donate via PayPal</p>
        </div>

    </div>

    <script>
        // --- DOM Elements ---
        const urlInput = document.getElementById('urlInput');
        const encodeButton = document.getElementById('encodeButton');
        const rnaOutput = document.getElementById('rnaOutput');
        const copyButton = document.getElementById('copyButton');
        
        const rnaInput = document.getElementById('rnaInput');
        const decodeButton = document.getElementById('decodeButton');
        const decodedLinkOutput = document.getElementById('decodedLinkOutput');
        
        const messageArea = document.getElementById('messageArea');

        // --- Mappings ---
        // 00 -> A (Adenine)
        // 01 -> U (Uracil)
        // 10 -> G (Guanine)
        // 11 -> C (Cytosine)
        const binaryToRna = { '00': 'A', '01': 'U', '10': 'G', '11': 'C' };
        const rnaToBinary = { 'A': '00', 'U': '01', 'G': '10', 'C': '11' };

        // --- Helper for showing messages ---
        function showMessage(text, isError = false) {
            messageArea.textContent = text;
            messageArea.className = isError 
                ? 'text-center mb-4 min-h-[1.5em] text-red-600' 
                : 'text-center mb-4 min-h-[1.5em] text-green-600';
            
            // Clear message after 3 seconds
            setTimeout(() => {
                if (messageArea.textContent === text) {
                    messageArea.textContent = '';
                    messageArea.className = 'text-center mb-4 min-h-[1.5em]';
                }
            }, 3000);
        }

        // --- Encoder Logic ---
        function encodeUrl() {
            const url = urlInput.value;
            if (!url) {
                showMessage('Please enter a URL to encode.', true);
                return;
            }

            try {
                const encoder = new TextEncoder();
                const uint8Array = encoder.encode(url);
                let rnaSequence = '';

                for (const byte of uint8Array) {
                    // Convert byte (0-255) to 8-bit binary string
                    const binary = byte.toString(2).padStart(8, '0');
                    
                    // Convert 8-bit binary string to 4 RNA bases
                    rnaSequence += binaryToRna[binary.substring(0, 2)];
                    rnaSequence += binaryToRna[binary.substring(2, 4)];
                    rnaSequence += binaryToRna[binary.substring(4, 6)];
                    rnaSequence += binaryToRna[binary.substring(6, 8)];
                }

                rnaOutput.value = rnaSequence;
                showMessage('Encoding successful!', false);
            } catch (e) {
                console.error('Encoding error:', e);
                showMessage('An error occurred during encoding.', true);
            }
        }

        // --- Decoder Logic ---
        function decodeRna() {
            const rna = rnaInput.value.trim().toUpperCase();
            if (!rna) {
                showMessage('Please enter an RNA sequence to decode.', true);
                return;
            }

            if (rna.length % 4 !== 0) {
                showMessage('Invalid sequence length. Must be a multiple of 4.', true);
                return;
            }

            try {
                const byteArray = [];
                let binaryString = '';

                for (const base of rna) {
                    const binaryPair = rnaToBinary[base];
                    if (binaryPair === undefined) {
                        showMessage(`Invalid RNA base detected: '${base}'. Only A, U, G, C allowed.`, true);
                        return;
                    }
                    binaryString += binaryPair;

                    // When we have 8 bits, convert to a byte
                    if (binaryString.length === 8) {
                        const byte = parseInt(binaryString, 2);
                        byteArray.push(byte);
                        binaryString = '';
                    }
                }

                const decoder = new TextDecoder();
                let url = decoder.decode(new Uint8Array(byteArray));

                // --- URL Validation ---
                // If the URL doesn't have a protocol, browsers treat it as a relative path.
                // We must add one for it to be an external link.
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    // Basic check to see if it looks like a domain vs. just text
                    if (url.includes('.') && !url.includes(' ')) {
                        url = 'https://' + url;
                    }
                }
                
                // Display the decoded link and a "Go to Site" button
                decodedLinkOutput.innerHTML = ''; // Clear previous
                decodedLinkOutput.className = 'w-full p-3 border border-gray-200 rounded-lg bg-gray-50 min-h-[5em]'; // Reset styles

                // Create text element for the URL
                const urlText = document.createElement('p');
                urlText.textContent = url; // Show the (now validated) URL
                urlText.className = 'text-gray-800 break-all mb-3'; // Non-clickable text

                // Create a "Copy" button
                const copyLinkButton = document.createElement('button');
                copyLinkButton.textContent = 'Copy Link';
                copyLinkButton.className = 'inline-block bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors';

                // Add a click listener to copy the URL
                const finalUrl = url; // Store URL for the closure
                copyLinkButton.addEventListener('click', () => {
                    // Use the 'execCommand' method as it's more robust in iframes
                    // than navigator.clipboard
                    const tempInput = document.createElement('textarea');
                    tempInput.style.position = 'absolute';
                    tempInput.style.left = '-9999px'; // Move it off-screen
                    tempInput.value = finalUrl;
                    
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    tempInput.setSelectionRange(0, 99999); // For mobile
                    
                    try {
                        document.execCommand('copy');
                        showMessage('Link copied to clipboard!', false);
                    } catch (e) {
                        console.error('Copy failed:', e);
                        showMessage('Could not copy link. Please copy it manually.', true);
                    }
                    
                    document.body.removeChild(tempInput);
                });


                decodedLinkOutput.appendChild(urlText);
                decodedLinkOutput.appendChild(copyLinkButton);

                showMessage('Decoding successful!', false);
            } catch (e) {
                console.error('Decoding error:', e);
                // This catch block handles errors from TextDecoder (e.g., invalid UTF-8)
                showMessage('Decoding error. The sequence may be invalid or corrupt.', true);
            }
        }

        // --- Copy to Clipboard Logic ---
        function copyToClipboard() {
            const sequence = rnaOutput.value;
            if (!sequence) {
                showMessage('Nothing to copy.', true);
                return;
            }

            // Select the text
            rnaOutput.select();
            rnaOutput.setSelectionRange(0, 99999); // For mobile devices

            try {
                // Use document.execCommand for compatibility
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessage('Copied to clipboard!', false);
                } else {
                    showMessage('Failed to copy.', true);
                }
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                showMessage('Failed to copy.', true);
            }

            // Deselect the text
            window.getSelection().removeAllRanges();
        }

        // --- Event Listeners ---
        encodeButton.addEventListener('click', encodeUrl);
        decodeButton.addEventListener('click', decodeRna);
        copyButton.addEventListener('click', copyToClipboard);

    </script>
</body>
</html>
